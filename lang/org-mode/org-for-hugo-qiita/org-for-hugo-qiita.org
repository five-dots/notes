#+STARTUP: content indent inlineimages latexpreview
#+PROPERTY: header-args:R :results output :cache yes :exports both :session *R:blog* :width 640 :height 480
#+OPTIONS: author:nil
#+OPTIONS: H:9
#+HUGO_BASE_DIR: ~/Dropbox/repos/github/five-dots/blog
#+HUGO_SECTION: post

* org-mode で Hugo と Qiita の記事を一元管理する
:PROPERTIES:
:EXPORT_FILE_NAME: org-for-hugo-qiita
:EXPORT_HUGO_SECTION*: 2019/11/
:END:

個人のブログを、[[https://gohugo.io/][Hugo]] + [[https://www.netlify.com/][Netlify]] で開始したが、それなりに力を入れて書いた技術記事は Qiita にも公開することで、広く読んでもらえるようにしたい。そこで、1 つの [[https://orgmode.org/ja/][org-mode]] ファイルから、個人ブログ向けには [[https://ox-hugo.scripter.co/][ox-hugo]] で、Qiita 向けには [[https://github.com/larstvei/ox-gfm][ox-gfm]] で Markdown ファイルを出力できないか試してみた。

なお、Hugo テーマは [[https://github.com/olOwOlo/hugo-theme-even][even]] を利用している。その他のテーマでは、この記事と異なる結果になる可能性もあるので、その点は注意が必要だ。

- org-file@github
- Hugo blog
- Qiita

** Software Version

| Software | Version         |
| OS       | Ubuntu 18.04    |
| Emacs    | 26.3            |
| org-mode | 9.2.6           |
| Hugo     | 0.59.1/extended |

** Heading
** h2
*** h3
**** h4
***** h5
****** h6

*Memo*
- ~*~ がタイトルとして扱われるため、 ~**~ (h2) から Heading として扱われる
- デフォルトでは、h4 までしか出力されないため、 ~#+OPTIONS: H:6~ のように追加で設定が必要
- [[https://github.com/olOwOlo/hugo-theme-even][even]] theme では h6 が最小

** Table/Text

| name      | org-mode    | result      |
|-----------+-------------+-------------|
| bold      | ~*hoge*~      | *hoge*        |
| italic    | ~/hoge/~      | /hoge/        |
| underline | ~_hoge_~      | _hoge_        |
| strike    | ~+hoge+~      | +hoge+        |
| code      | ~~hoge~~      | ~hoge~        |
| verbatim  | ~=hoge=~      | =hoge=        |
| greek     | ~\alpha~      | \alpha      |

*Memo*
- org-mode 記法でのアンダーラインは反映されていない

** List

順序なしリスト
- hoge
- fuga
- piyo

チェックボックス
 - [ ] hoge
 - [x] fuga
 - [ ] piyo

順序ありリスト
1. hoge
2. fuga
3. piyo

*Memo* 
- チェックボックスは、チェックをつけてしまうと表示されなくなってしまう

** Quote

#+begin_quote
Everything should be made as simple as possible,
but not any simpler ---Albert Einstein
#+end_quote

*Memo*
- 問題なく表示されている

** Formula

- インライン ~$y=f(x)$~

$y=f(x)$

- ブロック ~$$y=f(x)$$~

$$
y=f(x)
$$

- ブロック
#+begin_example
\begin{equation}
y=f(x)
\end{equation}
#+end_example

\begin{equation}
y=f(x)
\end{equation}

*Memo*
- ~\begin{equation} ... \end{equation}~ ブロックは Qiita では有効でない

** Footnote

- org-mode[fn:org] ~[fn:name]~
[fn:org] https://orgmode.org/ja/


*Memo*
- Qiita では有効でない

** Horizontal Rule

~-----~
-----

*Memo*
- 5 つの ~-~ で Markdown 側では ~---~ に変換される

** Code Block
*** Emacs Lisp

#+begin_src emacs-lisp :exports both
(emacs-version)
#+end_src

#+RESULTS:
: GNU Emacs 26.3 (build 2, x86_64-pc-linux-gnu, GTK+ Version 3.22.30)
:  of 2019-09-17

*** R
**** Code output

#+begin_src R
R.version
#+end_src

#+RESULTS:
#+begin_example
               _                           
platform       x86_64-pc-linux-gnu         
arch           x86_64                      
os             linux-gnu                   
system         x86_64, linux-gnu           
status                                     
major          3                           
minor          6.1                         
year           2019                        
month          07                          
day            05                          
svn rev        76782                       
language       R                           
version.string R version 3.6.1 (2019-07-05)
nickname       Action of the Toes
#+end_example

**** Table

#+begin_src R :results value :colnames yes
library(tidyverse)
head(iris)
#+end_src

#+RESULTS:
| Sepal.Length | Sepal.Width | Petal.Length | Petal.Width | Species |
|--------------+-------------+--------------+-------------+---------|
|          5.1 |         3.5 |          1.4 |         0.2 | setosa  |
|          4.9 |           3 |          1.4 |         0.2 | setosa  |
|          4.7 |         3.2 |          1.3 |         0.2 | setosa  |
|          4.6 |         3.1 |          1.5 |         0.2 | setosa  |
|            5 |         3.6 |          1.4 |         0.2 | setosa  |
|          5.4 |         3.9 |          1.7 |         0.4 | setosa  |

**** Plot

#+begin_src R :results graphics :exports code :file ./img/iris.png
library(ggplot2)
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + geom_point()
#+end_src

#+RESULTS:
[[file:./img/iris.png]]

#+attr_html:
[[https://dl.dropboxusercontent.com/s/4j5jstkg1fsvdiw/iris.png]]

*Memo*
- org-babel からプロット画像を出力する先を Dropbox フォルダに設定し共有リンク機能を利用して画像を公開する
- Hugo 向けには ~ox-hugo~ が自動で画像ファイルを ~static/~ へ移動してくれるので、本来は Dropbox を利用する必要はないが、Qiita と記事を共用するためには必要
- ~:exports code~ に設定することで、babel からのリンク出力を停止しつつ、ローカルではプロットをインライン画像で確認できる
- [[http://ijmp320.hatenablog.jp/entry/2015/01/18/171807][ここ]]の記事を参考に、Dropbox の直リンクに変換し、以下のように HTML として出力する
- 将来的には Dropbox API + Emacs Lisp で自動化したい

#+begin_src org
#+attr_html:
[[https://dl.dropboxusercontent.com/s/4j5jstkg1fsvdiw/iris.png]]
#+end_src

*** Python

#+begin_src python :session :exports both
import sys
sys.version
#+end_src

#+RESULTS:
: 3.6.8 (default, Oct  7 2019, 12:59:55) 
: [GCC 8.3.0]

** Reference

- [[https://sfus.net/blog/2018/12/org-mode-with-ox-hugo/][Org-mode で記事を書いて Hugo 向け markdown を ox-hugo で自動生成する話]]
- [[https://ladicle.com/post/ox-hugo-cheat/][ox-Hugo Cheat Sheet]]
- [[http://ijmp320.hatenablog.jp/entry/2015/01/18/171807][【備忘録】Dropboxの画像のURL（直リンク）の取得]]
 
* Footnotes
* COMMENT Local Variables                          :ARCHIVE:
# Local Variables:
# eval: (org-hugo-auto-export-mode)
# End:

